# DeepDive:대규모 트래픽으로 인한 서버 과부하 해결방법 2

## 서킷 브레이커

서킷 브레이커(Circuit Breaker)는 마이크로서비스 아키텍처에서 장애 확산을 방지하는 패턴이다. 특정 서비스나 API 요청이 계속 실패하면 일정 기간 동안 요청을 차단해서 시스템이 과부하되지 않도록 보호한다.

- 서비스와 서비스 사이에 서킷 브레이커 계층을 두고 미리 설정해놓은 timeout 임계값에 도달하면 서킷 브레이커가 그 이후의 추가 호출에 무조건 에러를 반환하게 함.
- 서킷 브레이커 패턴이라고도 불림.
- 연쇄적인 오류 전파를 끝내는 서킷 브레이커

### 동작과정

서킷 브레이커는 보통 3가지 상태로 동작한다.

1. Closed (닫힘) - 정상 상태

- API 요청을 정상적으로 보내고 응답을 받음
- 실패율이 낮거나 특정 임계값(threshold) 이하라면 계속 요청을 보냄

- ✅ 예시:

  ✅ “A 서비스” → “B 서비스”에 요청 보냄

  ✅ “B 서비스”가 정상 응답 반환

  ✅ 서킷 브레이커는 계속 닫힌 상태 유지

2. Open (열림) - 요청 차단 상태

- API 요청이 일정 횟수 이상 실패하면 서킷이 열림
- 이후 일정 시간 동안 요청을 보내지 않고 바로 실패 처리 (장애 확산 방지)
- Open 상태에서 일정 시간이 지나면 Half-Open 상태로 이동

- ❌ 예시:

  ❌ “A 서비스” → “B 서비스” 요청 보냄

  ❌ “B 서비스”가 연속으로 실패 응답(타임아웃, 500 에러)

  ❌ 실패율이 임계치 초과 → 서킷이 열림 → 이후 모든 요청 차단

3. Half-Open (반열림) - 테스트 상태

- Open 상태에서 일정 시간이 지나면 일부 요청을 다시 허용
- 만약 요청이 성공하면 Closed(정상) 상태로 복귀
- 요청이 다시 실패하면 Open 상태로 전환

- 🔄 예시:

  🔄 일정 시간 경과 후 일부 요청 허용

  🔄 성공하면 Closed로 복귀 / 실패하면 다시 Open

### 상태

- Closed (정상) 🟢: 요청 정상 처리
- Open (차단) 🔴: 요청 연속 실패 → 일정 시간 동안 차단
- Half-Open (테스트) 🟡: 일정 시간 후 일부 요청 테스트 → 성공 시 복구

### 장점

연속적인 에러 발생을 막아주며 일부 서비스가 종료되더라도 다른 서비스들은 이상없이 동작하게 만들 수 있으며 사용자경험을 높여준다.

### 적용 사례

- Netflix Hystrix: 장애 전파 방지를 위한 서킷 브레이커
- Resilience4j: Java에서 널리 사용되는 서킷 브레이커 라이브러리
- Spring Cloud Circuit Breaker: Spring 프로젝트에서 쉽게 적용 가능

## 컨텐츠 관리

1. 불필요한 컨텐츠 제거
2. CDN을 통한 컨텐츠 제공

- CDN(Content Delivery Network)은 전 세계 여러 서버에 데이터를 분산시켜서 사용자에게 더 빠르고 안정적으로 콘텐츠를 전달하는 시스템이다. 주로 웹사이트나 애플리케이션에서 이미지, 영상, 스타일시트(CSS), 자바스크립트 파일 등 정적 콘텐츠를 효율적으로 배포하는 데 사용된다.

3. 컨텐츠 캐싱
4. 컨텐츠 압축
5. 컨텐츠의 우하한 저하(미리 준비된 응답)
