# DEEP DIVE : HTTPS와 TLS #2. TLS 핸드셰이크

SSL은 버전이 올라가며 마지막으로 TLS로 명칭이 변경. (해당 문서는 TLS 1.3)

> #### TLS란?
>
> 전송 계층에서 보안을 제공하는 프로토콜.
> 클라이언트와 서버가 통신 할 때 TLS를 통해 제3자가 메시지를 도청하거나 변조하지 못하도록 함.

### TLS 과정

TLS버전을 정하고, 사이퍼슈트, 서버의 공개키, SSL인증서를 기반으로 인증작업을 수행.
이 후 대칭 암호화를 위해 세션키를 생성.

#### 1. Client Hello

클라이언트는 TLS버전, 사이퍼슈트와 클라이언트 랜덤값(무작위 문자열), 임시 DH 매개변수를 서버에게 보냄.

#### 2. Server Hello, EncryptedExtensions, Certificate, CertificateVerify

서버는 클라이언트로부터 받은 옵션을 확인.
서버와 클라이언트 모두에서 지원하는 가장 높은 TLS 버전을 식별하며 결정.
사이퍼슈트 지원 여부를 확인.
공개키가 포함된 SSL 인증서, 서버 랜덤값, 임시 DH 매개변수를 보냄.
클라이언트와 서버 각각 서로 교환한 DH 매개변수를 사용하여 임시 암호 키(세션키)를 생성.

#### 3. Finished

서버와 클라이언트 모두 이전에 교환된 모든 메시지에 대한 무결성과 인증을 확인하는 메시지를 보내고 클라이언트와 서버와 세션키를 기반으로 대칭 암호화된 통신 시작. (보안세션이 시작)

## DH(Diffie-Hellman) 매개변수

서로 공개값 공유, 비밀값과 혼합, 혼합값과 공유, 각자의 비밀값과 혼합해서 공통의 암호키를 만드는 알고리즘.

DH는 그냥 디피헬만을 사용하는 DHE와 타원곡선암호화 방법과 DH를 섞은 ECDHE가 있고 보통 ECDHE를 사용.

### 타원곡선 암호화 방법

곡선을 사용하여 개인 키 보유자만 알 수 있는 타원곡선을 그리고, 이를 기반으로 교차점을 생성하여, 교차점의 수를 기반으로 암호를 설정하는 방법

## 사이퍼슈트

프로토콜, AEAD 사이퍼 모드, 해싱 알고리즘이 나열된 규약을 말하며 암호제품군이라고도 불림.

### AEAD 사이퍼 모드

AEAD(Authenticated Encryption with Associated Data)는 데이터 암호화 알고리즘.

ex) AES_128_GCM

### 해싱 알고리즘

데이터를 추정하기 힘든 더 작고, 섞여 있는 조각으로 만드는 알고리즘.

ex) SHA-256, SHA-384

### Q. 해싱알고리즘은 TLS에서 어떻게 쓰이나요?

인증서가 올바른 인증서인지 확인할 때 전자서명을 이용하는데 이 때 해싱 알고리즘이 사용.

### 인증서

주체(인증서 발급한 CA, 도메인, 웹사이트 소유자, 인증서 소유자)와 공개키(공개키, 공개키암호화방법)를 포함하는 단순한 데이터 파일.
주체는 클라이언트가 접속한 서버가 클라이언트가 의도한 서버가 맞는지 확인할 때 쓰이고 공개키는 처음 인증작업을 수행할 때 쓰임.

### CA

인증서를 발급하는 기업을 CA(Certificate Authority).
서비스의 도메인, 공개키와 같은 정보는 서비스가 CA로부터 인증서를 구입할 때 제출.

### RSA의 취약점

RSA의 경우 클라이언트가 생성한 임시 암호값을 서버로 전송하지만,
DH의 경우 클라이언트와 서버가 서로 교환한 DH 매개변수를 사용해 개인키를 만듦.
=> RSA는 클라이언트에서 생성한 임시 암호값이 탈취당한 경우 해킹의 위험이 있음.
But, DH의 경우 탈취당해도 공통의 암호키를 못 만들기 때문에 더 좋음.

### 0 - RTT

세션키가 생성된 이 후 다시 그 사이트에 방문한다면 미리 만들어 놓은 세션키(PSK, pre-shared key)를 기반으로 연결을 생성하기 때문에 이 때 인증에 드는 비용이 없음.
=> 인증에 관한 RTT가 발생되지 않기 때문에 0- RTT.
