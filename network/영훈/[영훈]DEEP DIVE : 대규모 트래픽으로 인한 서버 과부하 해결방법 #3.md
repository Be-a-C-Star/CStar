## 컨텐츠 관리

### 1. 불필요한 컨텐츠 제거

#### Ex. 인프런에서 발생한 2022년 1월 100% 할인 이벤트 장애

![alt text](<스크린샷 2025-03-04 오후 3.01.59.png>)

- 인프런에서 다양한 분야의 강의 125개, 총 5,016,000원 강의를 모두 0원에 아래 기간동안 등록할 수 있는 이벤트를 진행.
- 본격 트래픽이 유입되니 1월 3일 오후 11:30분부터 1월 4일 새벽 01:30까지 2시간동안 쓰기 DB의 CPU가 90% 이상이 되어 전체 서비스가 사용이 불가능해짐.

![alt text](<스크린샷 2025-03-04 오후 3.07.02.png>)

- 강의 본문을 조회하는 셀렉트 쿼리문이 `select *`로 되어있어 사용 여부와 관계 없이 모든 컬럼을 조회하도록 되어있었고, 실제 용량을 측정해보면 해당 컬럼 1개의 값이 10KB 나 되는 고용량의 데이터였음.

##### 아래의 방법을 통해 문제를 해결

- 조회 쿼리를 개선
  - 인덱스를 추가하거나 쿼리를 변경해서 인덱스를 사용하도록 개선
  - 개선이 안되는 쿼리라면 차라리 기능 OFF
- `select *` 로 조회되던 컬럼에서 고용량인 강의 소개 컬럼은 모두 제거
  - 실제 기능에서 사용되지 않던 컬럼

### 2. CDN을 통한 컨텐츠 제공

![alt text](<스크린샷 2025-03-04 오후 3.08.34.png>)

- CDN을 통해 사용자 가까이, 그리고 분산된 대규모 서버 네트워크를 기반으로 컨텐츠를 제공해서 메인 서버에 대한 부하를 줄임
- 메인 서버에서 변하지 않는 정적 자원들(Ex. 이미지, JS, CSS, HTML)을 주는 것을 CDN을 이용하여 분산시켜 주도록 하여 메인 서버의 정적 자원 서빙을 할때의 비용을 줄일 수가 있음
- 예를 들어 기존에 메인 서버에서 정적 자원을 서빙하는데 10%의 CPU를 사용했다고 한다면, 10%의 CPU 비용을 CDN으로 대체하고 메인 서버에서는 100%의 CPU를 메인 로직을 처리하는데 쓸 수 있음

### 3. 컨텐츠 캐싱

- 네트워크 트래픽을 해결하는 가장 좋은 방법은 해당 트래픽이 발생하지 않도록 하는 것이다.
- 브라우저 캐시(쿠키, 로컬저장소, 세션저장소)를 통해 해당 요청에 관한 항목을 캐시에서 응답을 읽어 네트워크 요청에 관한 비용을 모두 제거할 수 있다.

### 4. 컨텐츠 압축

- 텍스트 기반 리소스는 gzip 또는 Brotli를 통해 압축해야 한다.
- 압축하면 70% 정도까지 압축할 수 있다. 다만 압축했기 때문에 압축을 풀기위해 서버에서 자원(CPU)를 사용하는 양까지 고려해야 한다.
- 텍스트 기반이라면 보통은 압축하여 사용하는 게 더 비용이 적다.

### 5. 컨텐츠의 우하한 저하(미리 준비된 응답)

- 시스템의 과도한 부하를 줄이기 위해 제공하는 컨텐츠 및 기능을 일시적으로 줄이는 전략이다.
- 예를 들어 정적 텍스트 페이지를 제공하거나, 검색을 비활성화하거나 더 적은 수의 검색 결과를 반환하거나, 필수적이지 않은 기능을 비활성화 한다.

#### Ex. 실제사례: 2023.05.31 서울시 경보 오발령 사태 당시 NHK WEB

##### 정상 상태

![alt text](<스크린샷 2025-03-04 오후 3.19.51.png>)

##### 2023.05.31 대규모 트래픽 발생 당시 우하한 저하를 적용 했을 떄

![alt text](<스크린샷 2025-03-04 오후 3.21.04.png>)

- 더 많은 사용자가 이용하게끔 하기 위해 필수적이지 않은 컨텐츠는 제외하고 경량화된 컨텐츠만 제공 (이미지, 동영상 삭제 등)
