### TCP/IP 4계층

#### 전송계층(Transport Layer)

###### 애플리케이션계층에서 받은 메시지를 기반으로 세그먼트 또는 데이터그램으로 데이터를 쪼개고 데이터가 오류없이 순서대로 전달되도록 도움을 주는 층

- TCP, UDP가 대표적임

###### TCP, UDP

- 전송 계층에 속하는 대표적인 프로토콜

#### 전송 계층의 역할

###### 1. 프로세스 간 통신 식별(Port 사용)

- 전송 계층은 포트(Port) 번호를 사용해 호스트 내부의 여러 프로세스 중 어느 프로세스가 데이터를 받을지 결정함
- Ex. 웹 서버(HTTP)는 보통 80번 포트, HTTPS는 443번 포트를 사용

###### 2. 신뢰성 제어(TCP의 경우)

- 패킷 손실, 순서 뒤바뀜, 중복 수신 등을 감지하고 자동으로 재전송·재정렬하여, 상위 레벨(애플리케이션)에는 정확하고 순서가 올바른 데이터가 전달되도록 함
- 흐름 제어, 혼잡 제어 등을 수행하여 네트워크 환경에서 무리 없이 데이터 전송이 이뤄지도록 조절함

###### 3. 비연결성·고속 전송(UDP의 경우)

- 연결 설정 없이 즉시 데이터 전송이 가능하고, 패킷 손실 등을 자체적으로 처리하지 않아 오버헤드가 낮고 전송 지연이 적음
- 주로 실시간성(스트리밍, 온라인 게임)이 중요한 경우 사용됨

#### 전송 계층의 동작 과정(예: TCP)

###### 1. 연결 설정(3-way handshake)

- 클라이언트가 서버에 SYN 패킷 전송 → 서버가 SYN+ACK 응답 → 클라이언트가 최종 ACK 전송
- 이 과정을 통해 서로 연결이 확립되고, 초기 시퀀스 번호를 교환하여 이후 데이터 송수신을 준비함

###### 2. 데이터 전송

- 세그먼트(Segment)에 시퀀스 번호, 확인 응답(ACK) 번호 등을 부여해 손실이나 순서 뒤바뀜을 감지
- 흐름 제어(슬라이딩 윈도우)와 혼잡 제어(느린 시작, 혼잡 회피) 알고리즘으로 네트워크 과부하 방지

###### 3. 연결 종료(4-way handshake)

- 한쪽에서 FIN을 보내면, 상대가 ACK를 보내고, 반대쪽도 마찬가지로 FIN/ACK를 교환하면서 순차적으로 연결을 종료

#### TCP

- 데이터를 전송하기 전에 송신자와 수신자가 3-way handshake 과정을 통해 논리적 연결을 수립해야 함
- 신뢰성 보장: 패킷 손실, 순서 뒤바뀜 등을 TCP가 스스로 감지하고 재전송/재정렬을 수행하여, 애플리케이션 입장에서는 데이터가 정확한 순서대로 도착한다고 인식할 수 있음
- 네트워크 상황에 따라 전송 속도를 조절하여 네트워크 혼잡과 패킷 손실을 줄임
- 데이터 전송 단위는 스트림(바이트 스트림) 형태이며, 경계가 명시적이지 않음. 즉, 한 번의 전송이 곧바로 한 번의 수신으로 이어지지 않을 수도 있음

###### 가상회선패킷교환방식을 사용

![alt text](<스크린샷 2024-12-29 오후 3.01.29.png>)

###### 오류검사 메커니즘 사용

- 시간 초과 기간이 지나면 서버는 전달되지 않은 데이터에 대해 재전송을 시도함
- 체크섬을 통해 무결성을 평가함. 즉, 송신된 데이터의 체크섬과 수신된 데이터의 체크섬 값을 비교해서 올바르게 왔는지를 확인

![alt text](<스크린샷 2024-12-29 오후 3.03.02.png>)

###### 헤더

![alt text](<스크린샷 2024-12-29 오후 3.10.02.png>)

- 20 ~ 60바이트로 가변적임

#### UDP

- 송신자와 수신자 간에 연결 과정을 거치지 않고, 필요한 경우 바로 데이터를 전송함
- 비신뢰성: 패킷 손실, 순서 뒤바뀜 등이 발생해도 이를 자동으로 복구하거나 재전송하지 않음
- TCP보다 헤더가 단순해 전송 속도가 빠른 편이며, 처리 과정도 적음
- 메시지(데이터그램) 단위로, 송신자에서 전송한 단위(패킷)가 수신자에게도 그대로 하나의 단위로 도착함(단, 손실이나 지연은 보장되지 않음)

###### 데이터그램패킷교환방식 사용

![alt text](<스크린샷 2024-12-29 오후 3.12.13.png>)

- 오류검사는 단순한 체크섬만 지원

###### 헤더

- 8 바이트로 고정 길이

![alt text](<스크린샷 2024-12-29 오후 3.14.31.png>)

#### TCP와 UDP 비교

![alt text](<스크린샷 2024-12-29 오후 3.15.06.png>)

##### TCP or UDP?

###### TCP를 선택해야 할 때

- 데이터 손실 없이 정확하고 순차적인 전송이 최우선
- 흐름 제어, 혼잡 제어 기능이 필요
- Ex. 웹 애플리케이션, 금융 거래, 서버-클라이언트 트랜잭션 기반 통신

###### UDP를 선택해야 할 때

- 실시간성(지연 최소화)이 더 중요하고, 패킷 일부 손실은 허용 가능
- 애플리케이션이 자체적으로 신뢰성(재전송, 순서 재구성 등)을 구현하거나, 손실을 무시해도 되는 경우
- Ex. 스트리밍 미디어, 온라인 게임, 화상 통화
