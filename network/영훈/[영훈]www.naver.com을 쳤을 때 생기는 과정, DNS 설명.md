## www.naver.com을 쳤을 때 생기는 과정

###### 리다이렉트, 캐싱, DNS, IP 라우팅 & ARP, TCP 연결 구축을 거쳐 요청, 응답이 일어나는 TTFB(Time to First Byte)가 시작되고 이 후 컨텐츠를 다운받게 되고 이 후 브라우저 렌더링 과정을 거쳐 네이버라는 화면이 나타나게 된다.

네트워크 요청 단계와 관련 타이밍의 다이어그램.
TTFB는 시작 시간과 응답 시작 사이의 경과 시간을 측정한 것을 말한다.
![alt text](<스크린샷 2025-03-11 오후 4.34.46.png>)

---

### 1. 리다이렉트

- 리다이렉트가 있다면 리다이렉트를 진행하고 없다면 그대로 해당 요청에 대한 과정이
  진행된다.

### 2. 캐싱

- 해당 요청이 캐싱이 가능한지 가능하지 않은지를 파악하고 캐싱이 이미 된 요청이라면 캐싱된 값을 반환하며, 캐싱이 되지 않은 새로운 요청이라면 그 다음 단계로 넘어간다.
- 브라우저 캐시와 공유 캐시로 나눠진다.

#### 1. 브라우저 캐시

- 쿠키, 로컬스토리지 등을 포함한 캐시다. 개인 캐시(private cache)라고도 한다.
  - 브라우저 자체가 사용자가 HTTP 를 통해 다운로드하는 모든 문서를 보유하는 것을 말한다.
  - 예를 들어 어떤 사이트를 갔다가 다시 방문하면 굉장히 빠르게 컨텐츠가 나타나는데, 이것이 바로 브라우저 캐시이다.
    ![alt text](<스크린샷 2025-03-11 오후 4.42.59.png>)
  - 또한 크롬 브라우저에서 인터넷 사용 기록 삭제를 들어가면 **쿠키 및 기타 사이트 데이터, 캐시**가 있는데, 바로 이 부분이 브라우저 캐시에 해당된다.

---

#### 2. 공유 캐시

- 클라이언트와 서버 사이에 있으며 사용자간에 공유할 수 있는 응답을 저장할 수 있다.
- 대표적인 예시로 요청한 서버 앞단에 프록시 서버가 캐싱을 하는 것을 말한다. 이를 **"리버스 프록시를 둬서 내부 서버로 포워드한다."** 라고도 말한다.

![alt text](<스크린샷 2025-03-11 오후 4.46.42.png>)

- Node.js로 서버를 구축한다면 앞단의 프록시 서버로 nginx 서버를 둬서 이 서버를 캐싱 서버로도 사용할 수 있다.

![alt text](<스크린샷 2025-03-11 오후 4.48.45.png>)

- AWS Cloudfront 또는 Cloudflare와 같은 콘텐츠 전송 네트워크 (CDN)을 둬서 캐싱할 수 있다.

![alt text](<스크린샷 2025-03-11 오후 4.49.29.png>)

- 캐시가 없다면 계속해서 요청이 생기지만 공유 캐시, 브라우저 캐시를 통해 요청을 줄일 수 있다.

---

### 3. DNS(Domain Name System)

###### 계층적인 도메인 구조와 분산된 데이터베이스를 이용한 시스템으로 FQDN을 인터넷 프로토콜인 IP로 바꿔주는 시스템. 이는 DNS관련 요청을 네임 서버로 전달하고 해당 응답값을 클라이언트에게 전달하는 리졸버, 도메인을 IP로 변환하는 네임 서버 등으로 이루어져 있다.

- 이제 캐싱을 거쳐서 요청해야 함이 분명해졌다면 실제 서버에 요청할 단계이다.
- 브라우저가 요청한 FQDN(Fully Qualified Domain Name)인 www.naver.com 등의 이름을 DNS를 통해 실제 IP 주소를 확인한다.

> FQDN(Fully Qualified Domain Name)❓
> 호스트와 도메인이 합쳐진 완전한 도메인 이름(wwww.naver.com)

- 여기서 www는 호스트 주소, Third level 도메인, sub 도메인 등으로 불린다.
- naver는 second level 도메인이다.
- com은 top level 도메인이라고 한다.

![alt text](<스크린샷 2025-03-11 오후 4.57.11.png>)

- www.naver.com에 DNS 쿼리가 오면 오른쪽부터 역순으로
- [Root DNS] → [.com DNS] → [.naver DNS] → [.www DNS] 과정을 거쳐 완벽한 주소를 찾아 IP 주소를 매핑한다.

#### DNS 캐싱

- DNS가 그냥 DNS에 바로 요청하지는 않는다. DNS 캐싱 서버를 통해 미리 해당 도메인 이름을 요청했다면 로컬 PC에 자동적으로 저장된다.
- 브라우저 캐싱, OS 캐싱이 있다.

![alt text](<스크린샷 2025-03-11 오후 5.03.13.png>)

- 크롬 브라우저 캐싱은 `chrome://net-internals/#dns`에서 캐싱된 도메인을 확인할 수 있다.

<br/>

![alt text](<스크린샷 2025-03-11 오후 5.02.10.png>)

- OS 캐싱은 터미널에 `ipconfig/displaydns`(window 기준)을 입력하면 캐싱된 도메인들을 확인할 수 있다.

---

### 4. IP 라우팅

- 해당 IP를 기반으로 IP 라우팅이 일어나고 ARP 과정을 거쳐 실제 서버를 찾는다.

### 5. TCP 연결 구축

- 이제 브라우저가 TCP 3웨이 - 핸드셰이크 및 SSL 연결등을 통해 연결을 설정한다.
- 이후 요청을 보내고 드디어 해당 요청한 서버로부터 응답을 받는다(여기선 네이버라는 서버가 될 것이다)
- TCP연결은 HTTP/2까지 일어난다.
- HTTP/3는 QUIC을 통해 연결하고 데이터를 주고 받는다.

### 6. 콘텐츠 다운로드

- 브라우저는 사용자가 요청한 컨텐츠를 서버로부터 다운로드받는다.
- 맨 처음부터 요청한 컨텐츠를 처음 다운로드 하는 시점까지를 TTFB(Time to First Byte)라고 한다.

### 7. 브라우저 렌더링

- 받은 데이터를 바탕으로 브라우저 엔진이 브라우저 렌더링 과정을 거쳐 화면을 만든다.
