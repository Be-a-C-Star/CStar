# 로그인

stateless의 특징을 가진 HTTP로 인해 요청이 끝나면 로그인 정보 등을 유지하지 않는 특징이 있다

## 세션 기반 인증

- 세션 : 서버와 클라이언트의 연결이 활성화된 상태
- 세션ID : 웹 서버 또는 DB에 저장되는 유니크한 ID

### 로그인 프로세스

1. 로그인 -> 세션 ID 생성 -> 서버에서 세션 ID를 쿠키로 설정하여 클라이언트에 전달
2. 클라이언트가 서버에 요청을 보낼 때 해당 세션 ID를 쿠키로 담아 로그인 정보 확인
3. 로그인 유지

세션 ID는 로컬 스토리지나 세션 스토리지에도 담을 수 있지만 쿠키에 담는 것이 관례여서 따르는 것이 좋다.

### 단점

- 로그인 중인 유저의 수가 늘어난다면 서버의 메모리 과부화가 발생할 수 있다
- RDBMS에 저장된다면 직렬화 및 역직렬화에 관한 오버헤드가 발생한다

## 토큰 기반 인증

state를 모두 토큰 자체로만 처리하여 토큰을 처리하는 한 서버만 두고 다른 컨텐츠를 제공하는 서버는 모두 stateless하게 두려는 이론이 담긴 방식으로 주로 JWT 토큰이 활용된다.

- access token
    - 짧은 수명
    - 서버에 요청할 때 주로 쓰인다
- refresh token
    - 비교적 긴 수명
    - access token이 만료되면 다시 얻기 위해 사용되는 토큰
    - 인증에 관한 비용을 줄여준다

### 인증 프로세스

1. 인증 로직 -> JWT 토큰 생성 (access token, refresh token)
2. 사용자는 access 토큰을 HTTP 헤더에 담아 인증이 필요한 서버에 요청해 컨텐츠를 가져온다

### JWT

- JSON Web Token
- JSON 객체로 인코딩되며 메시지 인증, 암호화 등에 사용된다
- 헤더, 페이로드, 서명으로 이루어져 있다
    - Header : 토큰 유형, 서명 알고리즘
    - Payload : 데이터, 토큰 발급자, 토큰 유효기간
    - Signature : 인코딩된 header + 인코딩된 payload + 비밀키를 기반으로 헤더에 명시된 알고리즘으로 다시 생성한 서명값

### 장점

- 인증에 필요한 정보는 토큰에 포함되어 별도의 저장소가 필요없다
- 다른 유형의 토큰과 달리 경량화되어있다
- 디코딩 시 JSON 형태이기 때문에 쉽게 직렬화 및 역직렬화가 가능하다

### 단점

- 토큰이 비대해질 경우 서버과부화에 영향을 준다
- 토큰이 탈취될 경우 디코딩하여 데이터를 확인할 수 있다

### 주의할 점

HTTP 헤더에 담아 요청할 땐 아래와 같은 규칙을 지키는 것이 좋다

- 토큰 앞에 `Bearer` 접두사를 두어 토큰 기반인 것을 알린다
- https를 사용한다
- 쿠키에 저장할 땐 `sameSite: 'Strict'`을 쓴다
- 수명이 짧은 access token을 발급한다
- url에 토큰을 전달하지 않는다

### 탈취 예방법

- access token의 수명을 짧게 하여 탈취되어도 유효한 기간을 최소화한다
- refresh token을 사용할 땐 추가적인 사용자 인증 단계를 요구한다
    - IP주소, 디바이스 정보, 2단계 인증 등
- 쿠키에 HttpOnly, Secure 옵션을 걸어 관리한다