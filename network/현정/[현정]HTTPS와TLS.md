## 암호화

- 승인된 사용자만 정보를 이해할 수 있도록 데이터를 스크램블한 방법
- 복호화 시 송신자와 수신자 모두 동의한 키가 필요하며 이를 만들기 위해 키가 쓰이기도 한다
- 의도된 수신자 또는 송신자를 제외하고는 통신을 하이재킹 할 수 없게 한다
- 민감한 데이터 유출을 방지하고 데이터 무결성을 보장한다

### 스크램블
- 단어나 문자를 무작위 방식으로 개별 데이터 비트를 섞는 것
- 암호화 시 비트가 높을 수록 스크램블을 많이 하고 복잡하게 만든다
- AES의 가장 약한 버전인 128비트부터 192비트, 256비트의 키 크기도 제공된다

### 대칭 암호화
- 키를 하나만 사용하는 암호화 방법
- 일반적으로 DES, AES를 사용

### 비대칭 암호화
- 공개키 암호화
- 두 개의 다른 키로 데이터를 암호화하거나 서명하고 키 중 하나인 공개 키를 누구나 사용할 수 있도록 하는 방법
- 공개키로 암호화 된 데이터는 개인키로만 복호화할 수 있다
- 일반적으로 RSA, DH(Diffie-Hellman)를 사용
- TLS는 부분적으로 비대칭 암호화를 사용, 비대칭 암호화로 인증 후 대칭 암호화로 보안적 통신을 시작 
- TLS 핸드셰이크 과정에서 인증할 때 비대칭 암호화를 사용, 이후 세션키를 기반으로 대칭 암호화 통신

## TLS 핸드셰이크

- 전송 계층에서 보안을 제공하는 프로토콜
- 클라이언트-서버 통신 시 제 3자가 메시지를 도청하거나 변조하지 못하도론 한다
- 사용할 TLS 버전을 정한 뒤 사이퍼 슈트, 서버의 공개키, SSL 인증서를 기반으로 인증 작업 수행, 이 후 Cost 감소를 위해 대칭 암호화로 세션키 생성

### 1. Client Hello

- 클라이언트는 TLS 버전, 사이퍼슈트, 클라이언트 랜덤값, 임시 DH 매개변수를 서버로 보낸다

### 2. Sever Hello, EncryptedExtensions, Certificate, CertificateVerify

- 서버는 클라이언트에게 받은 옵션을 확인
- 지원 가능한 가장 높은 TLS 버전을 식별하여 결정, 사이퍼슈트 지원 여부를 확인
- 공개키가 포함된 SSL 인증서, 서버 랜덤값, 임시 DH 매개변수 전송
- 클라이언트와 서버는 각각 교환한 DH 매개변수를 사용하여 임시 암호 키(세션키)를 생성    

#### 과정 설명

1. Server Hello : 서버는 클라이언트가 제공한 키 교환 매개변수를 기반으로 자신의 키 교환 매개변수를 생성하고 이를 클라이언트에게 전송
2. EncryptedExtensions : 필요한 추가 확장 정보를 함호화된 형태로 교환
3. Certificate : 서버는 자신의 인증서를 클라이언트에게 전송, 인증서에는 서버의 공개 키가 포함되며 이를 통해 서버의 신원을 검증
4. Certificate Verify : 서버는 자신의 개인 키를 사용하여 생성된 디지털 서명을 전송, 제공된 인증서의 유효성과 서버의 소유권을 증명

### 3. Finished

- 서버와 클라이언트는 이전에 교환된 모든 메시지에 대한 무결성과 인증을 확인하는 메시지를 보낸다
- 클라이언트와 서버, 세션키를 기반으로 대칭 암호화 통신 시작
- 대표적으로 RSA와 DH가 있으나 TLS1.3에서는 취약점이 있는 RSA를 지원하지 않는다
- DH는 타원곡선 DH를 사용

### DH 매개변수

- Diffie-Hellman : 서로 공개값 공유, 비밀값과 혼합, 혼합값과 공유, 각자의 비밀값과 혼합해서 공통의 암호키를 만드는 알고리즘
- 디피헬만을 사용하는 DHE와 타원 곡선 암호화와 DH를 섞은 ECDHE(주로 사용)가 존재
- 타원 곡선 암호화 : 곡선을 사용하여 개인 키 보유자만 알 수 있는 타원 곡선을 써서 이를 기반으로 교차점 생성, 교차점의 수를 기반으로 암호를 설정

### 사이퍼슈트(암호제품군)

- 프로토콜, AEAD 사이퍼 모드, 해싱 알고리즘이 나열된 규약
- TLS1.3버전에는 5개 존재하며 하나를 예로 들면 TLS는 프로토콜, AES_128_GCM은 AEAD 사이퍼모드, SHA256은 해싱 알고리즘을 뜻한다
    - TLS_AES_128_GCM_SHA256
    - TLS_AES_256_GCM_SHA384
    - TLS_CHACHA20_POLY1305_SHA256
    - TLS_AES_128_CCM_SHA256
    - TLS_AES_128_CCM_8_SHA256

#### AEAD 사이퍼 모드

- Authenticated Encryption with Associated Data
- 데이터 암호화 알고리즘
- 중간의 숫자는 키의 비트를 의미하며 뒤의 영문자는 결합된 암호화 알고리즘을 뜻한다

#### 해싱 알고리즘

- 데이터를 추정하기 힘들게 더 작고 섞여있는 조각으로 만드는 알고리즘
- SHA-256을 주로 이용하며 해시 함수 결과값이 256비트인 알고리즘이다
- TLS에서 인증서가 올바른 지 확인할 때 전자서명을 이용하는데 이 때 해싱 알고리즘이 쓰인다
    - 인증 생성 : 전자 서명을 위한 메시지를 해싱
    - 인증 확인 : 메시지를 복호화하여 해시를 서로 비교하여 올바른 지 확인

> 전자 서명 : 송신자가 자신의 신원을 증명하는 절차 또는 정보. 인증서에 적힌 주체가 서비스 제공자인 지 확인하고, 기록된 전자서명을 기반으로 CA의 공개키로 복화하하여 지문을 얻은 뒤 기록된 정보들을 해시 함수에 입력하여 해시를 얻어내 두 해시의 일치 여부를 확인한다. 이를 통해 인증서의 유효성을 검증한다.

### 인증서

- 주체(CA, 도메인, 웹 소유자, 인증서 소유자)와 공개키를 포함하는 데이터 파일
- 보통 인증기관인 CA에서 발급한 SSL 인증서를 기반으로 인증 작업을 수행한다
- 주체는 접속한 서버가 의도한 서버가 맞는 지 확인하고 공개키는 처음 인증을 수행할 때 쓰인다

### CA

- 클라이언트가 접속을 원한 서버가 맞음을 보장하는 역할
- 도메인, 공개키와 같은 정보는 인증서를 구입할 때 제출
- 다양한 유형의 인증서 제공
    - 단일 도메인 : 단 하나의 도메인에 적용
    - 와일드카드 : 하위 도메인도 포함
    - 멀티 도메인 : 관련되지 않은 다수의 도메인에도 적용

### RSA의 취약점

- RSA : 클라이언트가 생성한 임시 암호값을 서버로 전송
- DH : 클라이언트와 서버가 서로 교환한 DH 매개변수를 이용해 개인키 생성

RSA는 임시 암호값이 탈취될 경우 해킹의 위험이 있다

### 0-RTT

세션키가 생성된 이 후 사이트 재방문 시 이전에 만든 세션키 기반으로 연결을 생성하여 인증에 드는 비용이 없다