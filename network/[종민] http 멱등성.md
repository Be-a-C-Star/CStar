### 📌 HTTP 멱등성(Idempotency)  

**멱등성(Idempotency)**이란 **같은 요청을 여러 번 보내더라도 결과가 변하지 않는 성질**을 의미한다.  
즉, 동일한 HTTP 요청을 여러 번 반복해서 실행하더라도 **서버의 상태가 변하지 않거나, 동일한 응답을 반환하는 경우** 멱등성을 가진다고 말한다.  

---

## 🔹 HTTP 메서드와 멱등성  
HTTP 메서드 중 일부는 멱등성을 보장하며, 일부는 그렇지 않다.  
다음 표에서 멱등성을 가지는 메서드와 가지지 않는 메서드를 확인할 수 있다.  

| HTTP 메서드 | 멱등성 | 설명 |
|------------|------|----------------|
| `GET`  | ✅ | 여러 번 요청해도 같은 데이터를 조회할 뿐, 서버 상태는 변하지 않음 |
| `HEAD` | ✅ | GET과 동일하지만 본문을 반환하지 않음 |
| `OPTIONS` | ✅ | 서버의 옵션을 조회하는 용도로, 상태 변경 없음 |
| `PUT`  | ✅ | 같은 리소스에 여러 번 같은 요청을 보내더라도 결과가 동일함 (덮어쓰기) |
| `DELETE` | ✅ | 여러 번 같은 요청을 보내도 리소스가 존재하지 않는 경우 추가적인 변화가 없음 |
| `POST` | ❌ | 같은 요청을 반복하면 중복된 리소스가 생성될 수 있음 |
| `PATCH` | ❌ | 요청이 여러 번 반복되면, 리소스가 계속 변경될 수 있음 |

---

## 🔹 HTTP 멱등성 예제

### ✅ **멱등한 요청 예시**
#### **1. `GET` 요청 (멱등 O)**
```http
GET /users/123
```
- 사용자 정보(`users/123`)를 조회하는 요청이다.
- 여러 번 요청해도 같은 사용자 정보를 반환하며, 서버 상태는 변하지 않는다.

#### **2. `PUT` 요청 (멱등 O)**
```http
PUT /users/123
Content-Type: application/json

{
  "name": "Alice",
  "email": "alice@example.com"
}
```
- `PUT`은 리소스를 **덮어쓰기(overwrite)** 하기 때문에 여러 번 요청하더라도 최종 결과는 동일하다.
- 즉, 동일한 데이터를 다시 `PUT` 요청해도 서버의 상태는 변하지 않는다.

#### **3. `DELETE` 요청 (멱등 O)**
```http
DELETE /users/123
```
- 첫 번째 `DELETE` 요청에서는 `users/123`이 삭제됨.
- 이후 동일한 `DELETE` 요청을 보내도 이미 삭제된 상태라 추가적인 변화가 없음.

---

### ❌ **멱등하지 않은 요청 예시**
#### **1. `POST` 요청 (멱등 X)**
```http
POST /users
Content-Type: application/json

{
  "name": "Alice",
  "email": "alice@example.com"
}
```
- `POST` 요청은 새로운 리소스를 생성하는 역할을 한다.
- 같은 `POST` 요청을 여러 번 보내면 새로운 `users` 리소스가 계속 생성될 수 있다.  
  (예: `users/124`, `users/125` … 등으로 새로운 사용자 추가됨)

#### **2. `PATCH` 요청 (멱등 X)**
```http
PATCH /users/123
Content-Type: application/json

{
  "email": "alice_new@example.com"
}
```
- `PATCH`는 리소스의 일부를 수정하는 메서드이다.
- 같은 `PATCH` 요청을 여러 번 보내면, **데이터가 누적되거나 달라질 수 있다.**
  (예: `email`을 업데이트하는 동안 특정 로직이 실행되어 변경될 수도 있음)

---

## 🔹 왜 멱등성이 중요한가?
1. **네트워크 장애 시 안전한 재시도 가능**
   - 클라이언트가 요청을 보냈지만 응답을 받지 못한 경우(예: 인터넷 끊김), 다시 요청을 보내더라도 서버 상태가 변하지 않아야 함.
   - `PUT`이나 `DELETE`는 멱등하므로 여러 번 요청해도 서버의 상태가 일정하게 유지됨.

2. **부하 분산 및 캐싱 가능**
   - `GET` 요청이 멱등하므로, 브라우저나 CDN(Content Delivery Network)에서 캐싱이 가능함.
   - 캐싱을 통해 성능 최적화 및 서버 부하 감소 가능.

3. **트랜잭션 안정성 보장**
   - 금융 서비스나 데이터베이스 업데이트에서 같은 요청이 반복되더라도 데이터의 일관성이 유지될 수 있음.
   - 예를 들어, 같은 `PUT` 요청으로 특정 금액을 업데이트하는 경우, 여러 번 요청해도 최종 값이 동일함.

---

## 🔹 정리
- **멱등성(Idempotency)이란?**  
  → 같은 요청을 여러 번 보내도 서버 상태가 변하지 않는 성질.
- **멱등한 HTTP 메서드**: `GET`, `HEAD`, `OPTIONS`, `PUT`, `DELETE`
- **멱등하지 않은 HTTP 메서드**: `POST`, `PATCH`
- **멱등성이 중요한 이유**  
  → 네트워크 장애 시 안전한 재시도, 캐싱 가능, 데이터 일관성 유지.

