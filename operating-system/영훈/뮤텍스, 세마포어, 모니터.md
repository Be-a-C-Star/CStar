# 뮤텍스, 세마포어, 모니터

경쟁상태를 해결하는 대표적인 방법으로는 뮤텍스, 세마포어, 모니터 3가지가 있으며 이들은 상호배제, 한정대기, 진행의 융통성의 조건을 만족시키며 경쟁상태를 해결한다.

### 상호 배제(mutual exclusion)

- 한 프로세스가 임계 영역에 들어갔을 때 다른 프로세스는 들어갈 수 없다.

### 한정 대기(bounded waiting)

- 특정 프로세스가 임계영역 진입을 요청한 후 해당 요청이 승인되기 전까지 다른 프로세스가 임계영역에 진입하는 횟수를 제한하는 것을 말한다.
- 이를 통해 특정 프로세스가 영원히 임계 영역에 들어가지 못하게 하는 것을 방지한다.

### 진행의 융통성(progress)

- 만약 어떠한 프로세스도 임계영역을 사용하지 않는다면 임계영역 외부의 어떠한 프로세스도 들어갈 수 있으며 이 때 프로세스끼리 서로 방해하지 않는 것을 말한다.

## 뮤텍스(mutex)

공유 자원을 lock()을 통해 잠금설정하고 사용한 후에 unlock()을 통해 잠금해제가 되는 객체 lock을 기반으로 경쟁상태를 해결한다.

잠금이 설정되면 다른 프로세스나 스레드는 잠긴 코드 영역에 접근할 수 없고 해제는 그와 반대가 된다. 한번에 하나의 프로세스만 임계영역에 있을 수 있다.
![alt text](<스크린샷 2025-04-25 오후 7.52.10.png>)

## 세마포어(semaphore)

일반화된 뮤텍스를 말한다. 간단한 정수 S와 두 가지 함수 wait() 및 signal()로 공유 자원에 대한 접근을 처리한다. 이를 통해 여러 프로세스가 동시에 임계영역에 접근할 수 있다.

- S는 현재 쓸 수 있는 공유자원의 수
- wait() 는 S를 1씩 감소시킨다. 감소시키다 만약 S가 음수가 된다면 공유자원을 쓸
  수 없기 때문에 프로세스는 차단되며 대기열에 프로세스를 집어넣는다.
- signal()은 S를 1씩 증가시킨다. 공유자원을 프로세스가 다 쓴 상태를 말한다. 이
  때 만약 S가 0 이하라면 대기열에 있던 프로세스가 동작하게 된다.
  - 예를 들어, s.value가 -5라면 5개의 프로세스가 자원을 기다리며 대기 중인 것을 의미하며 이중 하나를 깨워 작업을 계속하도록 한다.
    ![alt text](<스크린샷 2025-04-25 오후 7.54.09.png>)

세마포어는 바이너리 세마포어와 카운팅 세마포어로 나뉜다.

### 바이너리 세마포어

0과 1의 두 가지 값만 가질 수 있는 세마포어이다.

- 구현의 유사성으로 인해 뮤텍스는 바이너리 세마포어라고 할 수 있지만 엄밀히 말하면 뮤텍스는 잠금을 기반으로 상호배제가 일어나는 ‘잠금 메커니즘’을 사용했고, 세마포어는 신호를 기반으로 상호 배제가 일어나는 ‘신호 메커니즘’을 사용한 점이 다르다.
- 여기서 신호 메커니즘은 휴대폰에서 노래를 듣다가 친구로부터 전화가 오면 노래가 중지되고 통화 처리 작업에 관한 인터페이스가 등장하는 것을 떠올리면 된다.

### 카운팅 세마포어

여러 개의 값을 가질 수 있는 세마포어이다.

## 모니터(monitor)

둘 이상의 스레드나 프로세스가 공유 자원에 안전하게 접근할 수 있도록 공유자원을 숨기고 해당 접근에 대해 인터페이스만 제공하는 객체다. 이를 통해 공유자원에 대한 작업들을 순차적으로 처리한다.
![alt text](<스크린샷 2025-04-25 오후 7.56.16.png>)

## 모니터와 세마포어 차이

- 모니터는 세마포어보다 구현하기 쉬우며 한번에 하나의 프로세스만 공유자원에 접근할 수 있다.
- 때문에 상호배제가 자동으로 이뤄진다.
- 인터페이스를 기반으로 구축된다.
- 세마포어는 모니터보다 구현하기가 어려우며 한번에 여러개의 프로세스가 공유자원에 접근할 수 있다.
- 이 때문에 상호배제를 명시적으로 구현해야 한다. 또한 정수 변수를 기반으로 구축된다.
