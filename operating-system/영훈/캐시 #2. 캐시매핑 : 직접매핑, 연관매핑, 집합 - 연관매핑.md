캐시의 크기는 메모리보다 항상 작기 때문에 효율적으로 매핑하는 것이 중요하며 매핑 방식에는 직접 매핑, 연관 매핑, 집합 - 연관 매핑이 있다.(직접 사상, 연관 사상, 집합 - 연관 사상이라고도 한다.)

## 직접 매핑(direct mapping)

메모리의 특정 블록은 특정 캐시 라인에만 매핑할 수 있는 것을 말한다.

- 예를 들어 메모리가 A개의 페이지, 캐시가 B개의 페이지로 구성된다고 했을 때 메모리의 페이지 수 A를 B개로 나누는 것이다.
- 이렇게 되면 메모리의 페이지의 수는 B \* 블록의 수가 된다.
- 메모리가 1~100이 있고 캐시가 1~5이 있다면 1:1~20, 2:21~40… 이런 식으로 매핑하는 것을 말한다.

![alt text](<스크린샷 2025-05-15 오후 12.39.18.png>)

- 운영체제는 메모리를 똑같은 크기의 페이지(보통 4kb)로 나눠서 관리를 하며 `<P, D>`로 나누어 관리한다.
- P(Page Number)는 페이지 번호이며 D(Page offset)는 페이지 번호로부터 해당 주소까지의 거리를 의미한다.

![alt text](<스크린샷 2025-05-15 오후 12.40.16.png>)

- 위 그림처럼 가상 주소는 20bits로 주소를 관리하기 때문에 더 많은 주소를 할당하는 것을 볼 수 있으며 이러한 주소가 16bits의 실제 주소로 페이지 테이블을 통해 변환되는 것을 볼 수 있다.
- 여기서 D(Page offset)은 변환되지 않고 변환되는 것은 P(Page Number)이다.

즉, 매핑되는 부분은 P이기 때문에 P만을 보면 되는데 P를 직접매핑에서는 {tag, bd}로 세분화해서 직접 매핑을 구현한다.

여기서 bd(block distance), 블럭을 위한 태그를 기반으로 `<tag, bd, D>`로 세분화하여 bd가 같은 라인만 매핑이 되게 한다.

![alt text](<스크린샷 2025-05-15 오후 12.42.27.png>)
![alt text](<스크린샷 2025-05-15 오후 12.42.52.png>)

- 예를 들어 주홍철의 자리는 주홍철, 김건우, 구성천만 들어올 수 있다.
- 이를 통해 해당 블록만 확인하면 되서 처리가 빠른 장점이 있지만 스와핑이 빈번하게 발생할 수 있다.
- 예를 들어 주홍철, 김건우, 구성천 순으로 원한다면 박종선, 방요셉, 강민기의 자리를 쓸 수 없고 스와핑이 잦아지게 된다.

## 연관 매핑(associative mapping)

###### 순서를 일치시키지 않고 관련 있는 캐시와 메모리를 매핑하며 메모리의 컨텐츠가 캐시의 어느 위치에도 올라갈 수 있는 방법

- 스와핑이 덜 일어나겠지만 캐시의 모든 블록을 탐색해야 해서 속도가 직접 매핑보다 느리다.
  ![alt text](<스크린샷 2025-05-15 오후 12.44.27.png>)
  ![alt text](<스크린샷 2025-05-15 오후 12.44.53.png>)
- 앞의 표처럼 연관매핑을 설명할 때는 bd와 tag를 합한 P로 설명한다.

---

## 집합 연관 매핑(set associate mapping)

집합을 나누고(정해진 집합을 만들다 - 직접매핑) 해당 집합에는 bd만 같으면 들어올 수 있게 하는데 이 때 어떤 블럭에도 들어올 수 있게 하는 것이다.

- 이를 통해 모든 블럭을 찾을 필요 없이 특정 블럭을 찾게 해 탐색비용을 낮춘 직접매핑의 장점과 스와핑을 완화시키는 연관매핑의 장점을 모두 지니게 된다.

![alt text](<스크린샷 2025-05-15 오후 12.46.21.png>)
![alt text](<스크린샷 2025-05-15 오후 12.46.36.png>)

- 예를 들어 위와 같이 캐시에서 bd가 0인 집합을 2개로 나누고 bd가 같은 것만 들어올 수 있게 하는 것.
- bd가 많지만 bd를 0 또는 1 밖에 없게 해고 집합을 2개로 나눈다.
- bd가 0인게 2개가 들어갈 수 있게, 1인게 2개가 들어갈 수 있게 나눈 것을 말한다.
